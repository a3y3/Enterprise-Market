$(document).ready(function(){
	if($("body").hasClass("rfqs new")){
		$("#btn-post-rfq").on("click", function(e){
			var input_term = $("#commodities-input-rfq-new").val();
			var option = $(".datalist-option-commodities[value='"+ input_term + "']");

			if(option.length != 0){
				$("#commodity_type_id").attr("value", option.data("value"));
			}
			else{
				alert("We don't provide the commodity you searched for, yet!");
				e.preventDefault();
			}
			//End check for commodities-search

			var input_term = $("#commodities-descriptions-input-rfq-new").val();
			var option = $(".datalist-option-description[value='"+ input_term + "']");

			if(option.length != 0){
				$("#commodity_type_description_id").attr("value", option.data("value"));
			}
			else{
				alert("Invalid product description!");
				e.preventDefault();
			}
			//End check for commodities-description
		});
		$("#commodities-input-rfq-new").on("keyup", function(){
			//remove all existing children of datalist
			var dataList = document.getElementById("commodities-datalist-rfq-new");
			var input = $(this);
			while(dataList.lastChild){
				dataList.removeChild(dataList.lastChild);
			}
			$.ajax({
		    url: "/commodities/search",
		    type: "GET",
		    dataType: "json",
		    data: {
		      'commodity': input.val()
		    	},
		    success: function (data, status, jqXHR) {
					var jsonData = JSON.parse(data.data);
		      jsonData.forEach(function(item){
		      	var option = document.createElement("option");
		      	option.setAttribute("value", item.name);
		      	option.setAttribute("data-value", item.id);
		      	option.setAttribute("class", "datalist-option-commodities");
		      	dataList.appendChild(option);
		      });
		    },
		    error: function (jqXHR, status, err) {
		      console.log("Error" + err);
		    }
		  });
		});
		$("#commodities-descriptions-input-rfq-new").on("keyup", function(){
			//remove all existing children of datalist
			var dataList = document.getElementById("commodities-description-datalist-rfq-new");
			var input = $(this);
			while(dataList.lastChild){
				dataList.removeChild(dataList.lastChild);
			}
			$.ajax({
		    url: "/commodities/search",
		    type: "GET",
		    dataType: "json",
		    data: {
		      'description': input.val(),
		      'selected_commodity': $('#commodities-input-rfq-new').val()
		    	},
		    success: function (data, status, jqXHR) {
					var jsonData = JSON.parse(data.data);
		      jsonData.forEach(function(item){
		      	var option = document.createElement("option");
		      	option.setAttribute("value", item.description);
		      	option.setAttribute("data-value", item.commodity_type_id);
		      	option.setAttribute("class", "datalist-option-commodities");
		      	dataList.appendChild(option);
		      });
		    },
		    error: function (jqXHR, status, err) {
		      console.log("Error" + err);
		    }
		  });
		});
	}
});